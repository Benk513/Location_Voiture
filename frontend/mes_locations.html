<!DOCTYPE html>
<html lang="zxx">
  <head>
    <title>Rentaly - Multipurpose Vehicle Car Rental Website Template</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16" />
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta
      content="Rentaly - Multipurpose Vehicle Car Rental Website Template"
      name="description"
    />
    <meta content="" name="keywords" />
    <meta content="" name="author" />
    <!-- CSS Files
    ================================================== -->
    <link
      href="css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
      id="bootstrap"
    />
    <link href="css/mdb.min.css" rel="stylesheet" type="text/css" id="mdb" />
    <link href="css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link href="css/coloring.css" rel="stylesheet" type="text/css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.12.1/font/bootstrap-icons.min.css"
    />
    <!-- color scheme -->
    <link
      id="colors"
      href="css/colors/scheme-01.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>

  <body>
    <div id="wrapper">
      <!-- page preloader begin -->
      <div id="de-preloader"></div>
      <!-- page preloader close -->

      <!-- header begin -->
      <header class="transparent scroll-light has-topbar">
        <div id="topbar" class="topbar-dark text-light">
          <div class="container">
            <div class="topbar-left xs-hide">
              <div class="topbar-widget">
                <div class="topbar-widget">
                  <a href="#"><i class="fa fa-phone"></i>+208 333 9296</a>
                </div>
                <div class="topbar-widget">
                  <a href="#"
                    ><i class="fa fa-envelope"></i>contact@rentaly.com</a
                  >
                </div>
                <div class="topbar-widget">
                  <a href="#"
                    ><i class="fa fa-clock-o"></i>Mon - Fri 08.00 - 18.00</a
                  >
                </div>
              </div>
            </div>

            <div class="topbar-right">
              <div class="social-icons">
                <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                <a href="#"><i class="fa fa-youtube fa-lg"></i></a>
                <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                <a href="#"><i class="fa fa-instagram fa-lg"></i></a>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="de-flex sm-pt10">
                <div class="de-flex-col">
                  <div class="de-flex-col">
                    <!-- logo begin -->
                    <div id="logo">
                      <a href="index.html">
                        <img
                          class="logo-1"
                          src="images/logo-light.png"
                          alt=""
                        />
                        <img class="logo-2" src="images/logo.png" alt="" />
                      </a>
                    </div>
                    <!-- logo close -->
                  </div>
                </div>
                <div class="de-flex-col header-col-mid">
                  <ul id="mainmenu">
                    <li>
                      <a class="menu-item" href="index.html">Home</a>
                      <ul>
                        <li>
                          <a class="menu-item new" href="02_dark-index-1.html"
                            >Homepage 1 Dark</a
                          >
                        </li>
                        <li>
                          <a class="menu-item new" href="02_dark-index-2.html"
                            >Homepage 2 Dark</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="index.html"
                            >Homepage Main</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="index-2.html"
                            >Homepage 2</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="index-3.html"
                            >Homepage 3</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="index-4.html"
                            >Homepage 4</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="index-5.html"
                            >Homepage 5</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="index-6.html"
                            >Homepage 6</a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="menu-item" href="cars.html">Cars</a>
                      <ul>
                        <li>
                          <a class="menu-item" href="cars.html">Cars List 1</a>
                        </li>
                        <li>
                          <a class="menu-item" href="02_dark-cars.html"
                            >Cars List 1 Dark</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="cars-list.html"
                            >Cars List 2</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="02_dark-cars-list.html"
                            >Cars List 2 Dark</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="car-single.html"
                            >Cars Single</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="02_dark-car-single.html"
                            >Cars Single Dark</a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="menu-item" href="quick-booking.html">Booking</a>
                      <ul>
                        <li>
                          <a class="menu-item new" href="quick-booking.html"
                            >Quick Booking</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="booking.html">Booking</a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="menu-item" href="account-dashboard.html"
                        >My Account</a
                      >
                      <ul>
                        <li>
                          <a class="menu-item" href="account-dashboard.html"
                            >Dashboard</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="account-profile.html"
                            >My Profile</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="account-booking.html"
                            >Mes Locations</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="account-favorite.html"
                            >My Favorite Cars</a
                          >
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="menu-item" href="#">Pages</a>
                      <ul>
                        <li>
                          <a class="menu-item" href="about.html">About Us</a>
                        </li>
                        <li>
                          <a class="menu-item" href="contact.html">Contact</a>
                        </li>
                        <li>
                          <a class="menu-item" href="login.html">Login</a>
                        </li>
                        <li>
                          <a class="menu-item" href="register.html">Register</a>
                        </li>
                        <li>
                          <a class="menu-item" href="404.html">Page 404</a>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="menu-item" href="#">News</a>
                      <ul>
                        <li>
                          <a
                            class="menu-item"
                            href="news-standart-right-sidebar.html"
                            >News Standard</a
                          >
                          <ul>
                            <li>
                              <a
                                class="menu-item"
                                href="news-standart-right-sidebar.html"
                                >Right Sidebar</a
                              >
                            </li>
                            <li>
                              <a
                                class="menu-item"
                                href="news-standart-left-sidebar.html"
                                >Left Sidebar</a
                              >
                            </li>
                            <li>
                              <a
                                class="menu-item"
                                href="news-standart-no-sidebar.html"
                                >No Sidebar</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            class="menu-item"
                            href="news-grid-right-sidebar.html"
                            >News Grid</a
                          >
                          <ul>
                            <li>
                              <a
                                class="menu-item"
                                href="news-grid-right-sidebar.html"
                                >Right Sidebar</a
                              >
                            </li>
                            <li>
                              <a
                                class="menu-item"
                                href="news-grid-left-sidebar.html"
                                >Left Sidebar</a
                              >
                            </li>
                            <li>
                              <a
                                class="menu-item"
                                href="news-grid-no-sidebar.html"
                                >No Sidebar</a
                              >
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>
                      <a class="menu-item" href="#">Elements</a>
                      <ul>
                        <li>
                          <a class="menu-item" href="preloader.html"
                            >Preloader</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="icon-boxes.html"
                            >Icon Boxes</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="badge.html">Badge</a>
                        </li>
                        <li>
                          <a class="menu-item" href="counters.html">Counters</a>
                        </li>
                        <li>
                          <a class="menu-item" href="gallery-popup.html"
                            >Gallery Popup</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="icons-elegant.html"
                            >Icons Elegant</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="icons-etline.html"
                            >Icons Etline</a
                          >
                        </li>
                        <li>
                          <a class="menu-item" href="icons-font-awesome.html"
                            >Icons Font Awesome</a
                          >
                        </li>
                        <li><a class="menu-item" href="map.html">Map</a></li>
                        <li>
                          <a class="menu-item" href="modal.html">Modal</a>
                        </li>
                        <li>
                          <a class="menu-item" href="popover.html">Popover</a>
                        </li>
                        <li><a class="menu-item" href="tabs.html">Tabs</a></li>
                        <li>
                          <a class="menu-item" href="tooltips.html">Tooltips</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="de-flex-col">
                  <div class="menu_side_area">
                    <div class="de-login-menu">
                      <span id="de-click-menu-profile" class="de-menu-profile">
                        <img
                          src="images/profile/1.jpg"
                          class="img-fluid"
                          alt=""
                        />
                      </span>

                      <div id="de-submenu-profile" class="de-submenu">
                        <div class="d-name">
                          <h4>Monica Lucas</h4>
                          <span class="text-gray">monica@rentaly.com</span>
                        </div>

                        <div class="d-line"></div>

                        <ul class="menu-col">
                          <li>
                            <a href="account-dashboard.html"
                              ><i class="fa fa-home"></i>Dashboard</a
                            >
                          </li>
                          <li>
                            <a href="account-profile.html"
                              ><i class="fa fa-user"></i>My Profile</a
                            >
                          </li>
                          <li>
                            <a href="account-booking.html"
                              ><i class="fa fa-calendar"></i>Mes Locations</a
                            >
                          </li>
                          <li>
                            <a href="account-favorite.html"
                              ><i class="fa fa-car"></i>My Favorite Cars</a
                            >
                          </li>
                          <li>
                            <a href="login.html"
                              ><i class="fa fa-sign-out"></i>Sign Out</a
                            >
                          </li>
                        </ul>
                      </div>
                      <span id="menu-btn"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- header close -->
      <!-- content begin -->
      <div class="no-bottom no-top zebra" id="content">
        <div id="top"></div>

        <!-- section begin -->
        <section id="subheader" class="jarallax text-light">
          <img src="images/background/14.jpg" class="jarallax-img" alt="" />
          <div class="center-y relative text-center">
            <div class="container">
              <div class="row">
                <div class="col-md-12 text-center">
                  <h1>Mes Locations</h1>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>
        </section>
        <!-- section close -->

        <section id="section-settings" class="bg-gray-100">
          <div class="container">
            <div class="row">
              <div class="col-lg-3 mb30">
                <div class="card p-4 rounded-5">
                  <div class="profile_avatar">
                    <div class="profile_img">
                      <img src="images/profile/1.jpg" alt="" />
                    </div>
                    <div class="profile_name">
                      <h4>
                        Monica Lucas
                        <span class="profile_username text-gray"
                          >monica@rentaly.com</span
                        >
                      </h4>
                    </div>
                  </div>
                  <div class="spacer-20"></div>
                  <ul class="menu-col">
                    <li>
                      <a href="account-dashboard.html"
                        ><i class="fa fa-home"></i>Dashboard</a
                      >
                    </li>
                    <li>
                      <a href="account-profile.html"
                        ><i class="fa fa-user"></i>My Profile</a
                      >
                    </li>
                    <li>
                      <a href="mes_locations.html" class="active"
                        ><i class="fa fa-calendar"></i>Mes Locations</a
                      >
                    </li>
                    <li>
                      <a href="account-favorite.html"
                        ><i class="fa fa-car"></i>My Favorite Cars</a
                      >
                    </li>
                    <li>
                      <a href="login.html"
                        ><i class="fa fa-sign-out"></i>Se deconnecter</a
                      >
                    </li>
                  </ul>
                </div>
              </div>

              <div class="col-lg-9">
                <div class="card p-4 rounded-5 mb25">
                  <h4>Mes Locations</h4>

                  <table class="table de-table">
                    <thead>
                      <tr>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >ID Location</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Nom du vehicule</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Adresse de Retrait</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Adresse de Retour</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Date de Retrait</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Date de Retour</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Statut</span
                          >
                        </th>
                        <th scope="col">
                          <span class="text-uppercase fs-12 text-gray"
                            >Actions</span
                          >
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>
                          <span class="d-lg-none d-sm-block">ID Location</span>
                          <div class="badge bg-gray-100 text-dark">#01236</div>
                        </td>
                        <td>
                          <span class="d-lg-none d-sm-block">Car Name</span
                          ><span class="bold">Range Rover</span>
                        </td>
                        <td>
                          <span class="d-lg-none d-sm-block"
                            >Pick Up Location</span
                          >Virginia
                        </td>
                        <td>
                          <span class="d-lg-none d-sm-block"
                            >Drop Off Location</span
                          >Oregon
                        </td>
                        <td>
                          <span class="d-lg-none d-sm-block">Pick Up Date</span
                          >March 2, 2023
                        </td>
                        <td>
                          <span class="d-lg-none d-sm-block">Return Date</span
                          >March 13, 2023
                        </td>
                        <td>
                          <div class="badge rounded-pill bg-danger">
                            completed
                          </div>
                        </td>
                        <td>
                          <div class="badge rounded-pill bg-success">
                            <i class="bi bi-check-circle-fill"></i>
                          </div>
                          <div class="badge rounded-pill bg-danger">
                            <i class="bi bi-x-circle-fill"></i>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      <!-- content close -->

      <a href="#" id="back-to-top"></a>

      <!-- footer begin -->
      <footer class="text-light">
        <div class="container">
          <div class="row g-custom-x">
            <div class="col-lg-3">
              <div class="widget">
                <h5>About Rentaly</h5>
                <p>
                  Where quality meets affordability. We understand the
                  importance of a smooth and enjoyable journey without the
                  burden of excessive costs. That's why we have meticulously
                  crafted our offerings to provide you with top-notch vehicles
                  at minimum expense.
                </p>
              </div>
            </div>

            <div class="col-lg-3">
              <div class="widget">
                <h5>Contact Info</h5>
                <address class="s1">
                  <span
                    ><i class="id-color fa fa-map-marker fa-lg"></i>08 W 36th
                    St, New York, NY 10001</span
                  >
                  <span
                    ><i class="id-color fa fa-phone fa-lg"></i>+1 333 9296</span
                  >
                  <span
                    ><i class="id-color fa fa-envelope-o fa-lg"></i
                    ><a href="mailto:contact@example.com"
                      >contact@example.com</a
                    ></span
                  >
                  <span
                    ><i class="id-color fa fa-file-pdf-o fa-lg"></i
                    ><a href="#">Download Brochure</a></span
                  >
                </address>
              </div>
            </div>

            <div class="col-lg-3">
              <h5>Quick Links</h5>
              <div class="row">
                <div class="col-lg-6">
                  <div class="widget">
                    <ul>
                      <li><a href="#">About</a></li>
                      <li><a href="#">Blog</a></li>
                      <li><a href="#">Careers</a></li>
                      <li><a href="#">News</a></li>
                      <li><a href="#">Partners</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-3">
              <div class="widget">
                <h5>Social Network</h5>
                <div class="social-icons">
                  <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                  <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                  <a href="#"><i class="fa fa-linkedin fa-lg"></i></a>
                  <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                  <a href="#"><i class="fa fa-rss fa-lg"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="subfooter">
          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <div class="de-flex">
                  <div class="de-flex-col">
                    <a href="index.html">
                      Copyright 2025 - Rentaly by Designesia
                    </a>
                  </div>
                  <ul class="menu-simple">
                    <li><a href="#">Terms &amp; Conditions</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- footer close -->
    </div>

    <!-- Javascript Files
    ================================================== -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>

    
    <script>
        $(".deconnexion").click(function () {
          alert("À bientôt !");
          localStorage.clear();
          window.location.href = "login.html";
        });
      </script>


    <script>
      $(document).ready(function () {
        const user = JSON.parse(localStorage.getItem("utilisateur"));
        const token = localStorage.getItem("token")

        if (!token) {
          alert("Vous devez être connecté.");
          return;
        }

        // Fonction pour formatter une date proprement
        function formatDate(dateString) {
          const options = { year: "numeric", month: "long", day: "numeric" };
          return new Date(dateString).toLocaleDateString("fr-FR", options);
        }

        // Fonction pour charger les données
        function chargerLocations() {
          $.ajax({
            url: "http://localhost:5000/api/locations/mesDemandesDeLocations",
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
            success: function (res) {
              const tbody = $(".de-table tbody");
              tbody.empty(); // On vide le tableau
const locations = res.data;
              console.log(res)

              if (locations.length === 0) {
                tbody.append(`
                    <tr>
                      <td colspan="8" class="text-center">Aucune demande de location trouvée.</td>
                    </tr>
                  `);
                return;
              }

              locations.forEach((loc) => {
                const statutBadge =
                  {
                    en_attente: `<div class="badge rounded-pill bg-warning text-dark">En attente</div>`,
                    approuvee: `<div class="badge rounded-pill bg-success">Approuvée</div>`,
                    rejetee: `<div class="badge rounded-pill bg-danger">Rejetée</div>`,
                    terminee: `<div class="badge rounded-pill bg-secondary">Terminée</div>`,
                  }[loc.statut] || loc.statut;

                const actions =
                  loc.statut === "en_attente"
                    ? `
                      <div class="badge rounded-pill bg-success action-valider" data-id="${loc._id}">
                        <i class="bi bi-check-circle-fill"></i>
                      </div>
                      <div class="badge rounded-pill bg-danger action-rejeter" data-id="${loc._id}">
                        <i class="bi bi-x-circle-fill"></i>
                      </div>
                    `
                    : `<span class="text-muted">-</span>`;

                tbody.append(`
                    <tr>
                      <td><div class="badge bg-gray-100 text-dark">#${loc._id.slice(
                        -5
                      )}</div></td>
                      <td><span class="bold">${
                        loc.annonce?.voiture?.nom || "N/A"
                      }</span></td>
                      <td>${loc?.adresseRetrait || "N/A"}</td>
                      <td>${loc?.adresseDepot || "N/A"}</td>
                      <td>${formatDate(loc.dateDebut)}</td>
                      <td>${formatDate(loc.dateFin)}</td>
                      <td>${statutBadge}</td>
                      <td>${actions}</td>
                    </tr>
                  `);
              });
            },
            error: function (err) {
              alert("Erreur lors du chargement des locations.");
              console.error(err);
            },
          });
        }

        // Fonction pour traiter (accepter ou rejeter) une demande
        function traiterDemande(locationId, action) {
          const confirmation = confirm(
            action === "accepter"
              ? "Accepter cette demande ?"
              : "Rejeter cette demande ?"
          );
          if (!confirmation) return;

          $.ajax({
            url: `http://localhost:5000/api/locations/traiterDemandeLocation/${locationId}`,
            method: "PATCH",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            data: JSON.stringify({ statut: action }),
            success: function () {
              alert("Demande traitée avec succès !");
              chargerLocations(); // Recharger les données
            },
            error: function (err) {
              const msg =
                err.responseJSON?.message || "Une erreur est survenue.";
              alert("Erreur : " + msg);
            },
          });
        }

        // Charger les données au chargement
        chargerLocations();

        // Écouteurs d'événement délégués
        $(document).on("click", ".action-valider", function () {
          const id = $(this).data("id");
          traiterDemande(id, "accepter");
        });

        $(document).on("click", ".action-rejeter", function () {
          const id = $(this).data("id");
          traiterDemande(id, "rejeter");
        });
      });
    </script>
  </body>
</html>
