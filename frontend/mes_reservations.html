<script>
  const token = localStorage.getItem("token");
  const role= localStorage.getItem("role")
  if (!token) {
    window.location.href = "login.html"; // Redirige vers login
  }
</script>
<!DOCTYPE html>
<html lang="zxx">

<head>
  <title>Rentaly - Multipurpose Vehicle Car Rental Website Template</title>
  <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16">
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="Rentaly - Multipurpose Vehicle Car Rental Website Template" name="description">
  <meta content="" name="keywords">
  <meta content="" name="author">
  <!-- CSS Files
  ================================================== -->
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
  <link href="css/mdb.min.css" rel="stylesheet" type="text/css" id="mdb">
  <link href="css/plugins.css" rel="stylesheet" type="text/css">
  <link href="css/style.css" rel="stylesheet" type="text/css">
  <link href="css/coloring.css" rel="stylesheet" type="text/css">
  <!-- color scheme -->
  <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css">
</head>

<body>
  <div id="wrapper">
      
      <!-- page preloader begin -->
      <div id="de-preloader"></div>
      <!-- page preloader close -->

      <!-- header begin -->
      <header class="transparent scroll-light has-topbar">
          <div id="topbar" class="topbar-dark text-light">
              <div class="container">
                  <div class="topbar-left xs-hide">
                      <div class="topbar-widget">
                          <div class="topbar-widget"><a href="#"><i class="fa fa-phone"></i>+208 333 9296</a></div>
                          <div class="topbar-widget"><a href="#"><i class="fa fa-envelope"></i>contact@rentaly.com</a></div>
                          <div class="topbar-widget"><a href="#"><i class="fa fa-clock-o"></i>Mon - Fri 08.00 - 18.00</a></div>
                      </div>
                  </div>
              
                  <div class="topbar-right">
                      <div class="social-icons">
                          <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                          <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                          <a href="#"><i class="fa fa-youtube fa-lg"></i></a>
                          <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                          <a href="#"><i class="fa fa-instagram fa-lg"></i></a>
                      </div>
                  </div>  
                  <div class="clearfix"></div>
              </div>
          </div>
          <div class="container">
              <div class="row">
                  <div class="col-md-12">
                      <div class="de-flex sm-pt10">
                          <div class="de-flex-col">
                              <div class="de-flex-col">
                                  <!-- logo begin -->
                                  <div id="logo">
                                      <a href="index.html">
                                          <img class="logo-1" src="images/logo-light.png" alt="">
                                          <img class="logo-2" src="images/logo.png" alt="">
                                      </a>
                                  </div>
                                  <!-- logo close -->
                              </div>
                          </div>
                          <div class="de-flex-col header-col-mid">
                              <ul id="mainmenu">
                                  <li>
                                    <a class="menu-item" href="index.html">Accueil</a>
                                 
                                   
                                   
                                  </li>
                                  <li>
                                    <a class="menu-item" href="cars.html">Voitures</a>
                                     
                                  </li>
                                  <li>
                                    <a class="menu-item" href="cars.html">Contact</a>
                                     
                                  </li>
                                  
                              
                                
                                   
                                </ul>
                          </div>
                        <div class="de-flex-col">

<div class="menu_side_area " id="loginUI">
                    <a href="login.html" class="btn-main">Se connecter</a>
                    <span id="menu-btn"></span>
                  </div>
                                <div class="menu_side_area" id="accountUI">
                                    <div class="de-login-menu">

                                        <span id="de-click-menu-profile" class="de-menu-profile">                           
                                            <img src="images/profile/1.jpg" class="img-fluid photo" alt="">
                                        </span>

                                        

                                        <div id="de-submenu-profile" class="de-submenu">
                                            <div class="d-name">
                                                <h4 class="nom">Monica Lucas</h4>
                                                <span class="text-gray email"></span>
                                                <span class="text-gray role"></span>
                                            </div>

                                            <div class="d-line"></div>

                                            <ul class="menu-col">
                                                <li><a href="account-dashboard.html" id="accountRedirect"><i class="fa fa-home"></i>Tableau de bord</a></li>
                                                <li><a href="account-profile.html"><i class="fa fa-user"></i>Mon profile</a></li>
                                                  <li><span class="deconnexion"><i class="fa fa-sign-out"></i> Se deconnecter</span></li> 
                                            </ul>
                                        </div>
                                        <span id="menu-btn"></span>
                                    </div>
                                </div>
                            </div>
                      </div>
                  </div>
              </div>
          </div>
      </header>
          <!-- header close -->
      <!-- content begin -->
      <div class="no-bottom no-top zebra" id="content">
          <div id="top"></div>
          
          <!-- section begin -->
          <section id="subheader" class="jarallax text-light">
              <img src="images/background/14.jpg" class="jarallax-img" alt="">
                  <div class="center-y relative text-center">
                      <div class="container">
                          <div class="row">
                              <div class="col-md-12 text-center">
                <h1>Mon espace</h1>
                              </div>
                              <div class="clearfix"></div>
                          </div>
                      </div>
                  </div>
          </section>
          <!-- section close -->

          <section id="section-cars" class="bg-gray-100">
              <div class="container">
                  <div class="row">
                      <div class="col-lg-3 mb30">
                          <div class="card p-4 rounded-5">
                              <div class="profile_avatar">
                                  <div class="profile_img">
                                      <img src="images/profile/frPatrickBanza.jpg" class="photo" alt="">
                                  </div>
                                  <div class="profile_name">
                                      <h4 class="nom">
                                          Patrick Banza                                                
                                      </h4>
                                      <span class="profile_username text-gray email" id="email">patrickbanza@ardias.com</span>
                                  </div>
                              </div>
                              <div class="spacer-20"></div>
                              <ul class="menu-col">
                                  <li><a href="" class="active"><i class="fa fa-home"></i>Tableau de bord</a></li>
                                  <li><a href="account-profile.html"><i class="fa fa-user"></i>Mon Profil</a></li>
                                  <li><a href="mes_reservations.html"><i class="fa fa-calendar"></i>Mes Reservations</a></li>
                                  <li><span class="deconnexion" type="button"  ><i class="fa fa-sign-out"></i>Se deconnecter</button=></li>
                              </ul>
                          </div>
                      </div>
                      

                      <div class="col-lg-9">
                          <!-- <div class="row">
                              <div class="col-lg-3 col-6 mb25 order-sm-1">
                                  <div class="card p-4 rounded-5">
                                      <div class="symbol mb40">
                                          <i class="fa id-color fa-2x fa-calendar-check-o"></i>
                                      </div>
                                      <span class="h1 mb0">03</span>
                                      <span class="text-gray">Upcoming Orders</span>
                                  </div>
                              </div>

                              <div class="col-lg-3 col-6 mb25 order-sm-1">
                                  <div class="card p-4 rounded-5">
                                      <div class="symbol mb40">
                                          <i class="fa id-color fa-2x fa-tags"></i>
                                      </div>
                                      <span class="h1 mb0">12</span>
                                      <span class="text-gray">Coupons</span>
                                  </div>
                              </div>

                              <div class="col-lg-3 col-6 mb25 order-sm-1">
                                  <div class="card p-4 rounded-5">
                                      <div class="symbol mb40">
                                          <i class="fa id-color fa-2x fa-calendar"></i>
                                      </div>
                                      <span class="h1 mb0">58</span>
                                      <span class="text-gray">Total des locations</span>
                                  </div>
                              </div>

                              <div class="col-lg-3 col-6 mb25 order-sm-1">
                                  <div class="card p-4 rounded-5">
                                      <div class="symbol mb40">
                                          <i class="fa id-color fa-2x fa-calendar-times-o"></i>
                                      </div>
                                      <span class="h1 mb0">24</span>
                                      <span class="text-gray">Cancel Orders</span>
                                  </div>
                              </div>
                          </div> -->

                          <div class="card p-4 rounded-5 mb25">
                              <h4>Mes Reservations recentes</h4>

                              <table class="table de-table">
                                <thead>
                                  <tr>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Order ID</span></th>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Car Name</span></th>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Pick Up Location</span></th>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Drop Off Location</span></th>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Pick Up Date</span></th>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Return Date</span></th>
                                    <th scope="col"><span class="text-uppercase fs-12 text-gray">Status</span></th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td><span class="d-lg-none d-sm-block">Order ID</span><div class="badge bg-gray-100 text-dark">#01236</div></td>
                                    <td><span class="d-lg-none d-sm-block">Car Name</span><span class="bold">Jeep Renegade</span></td>
                                    <td><span class="d-lg-none d-sm-block">Pick Up Location</span>New York</td>
                                    <td><span class="d-lg-none d-sm-block">Drop Off Location</span>Los Angeles</td>
                                    <td><span class="d-lg-none d-sm-block">Pick Up Date</span>March 2, 2023</td>
                                    <td><span class="d-lg-none d-sm-block">Return Date</span>March 10, 2023</td>
                                    <td><div class="badge rounded-pill bg-success">completed</div></td>
                                  </tr>
                                  <tr>
                                    <td><span class="d-lg-none d-sm-block">Order ID</span><div class="badge bg-gray-100 text-dark">#01263</div></td>
                                    <td><span class="d-lg-none d-sm-block">Car Name</span><span class="bold">Mini Cooper</span></td>
                                    <td><span class="d-lg-none d-sm-block">Pick Up Location</span>San Fransisco</td>
                                    <td><span class="d-lg-none d-sm-block">Drop Off Location</span>Chicago</td>
                                    <td><span class="d-lg-none d-sm-block">Pick Up Date</span>March 8, 2023</td>
                                    <td><span class="d-lg-none d-sm-block">Return Date</span>March 10, 2023</td>
                                    <td><div class="badge rounded-pill bg-danger">cancelled</div></td>
                                  </tr>
                               
                                
                               
                                </tbody>
                              </table>
                          </div>
                           
                      </div>
                  </div>
              </div>
          </section>
    
    
      </div>
      <!-- content close -->

      <a href="#" id="back-to-top"></a>
      
      
      
  </div>


  <!-- Javascript Files
  ================================================== -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script src="js/plugins.js"></script>
  <script src="js/designesia.js"></script>

  <script>
      $(".deconnexion").click(function () {
        alert("À bientôt !");
        localStorage.clear();
        window.location.href = "login.html";
      });
    </script>


   <script>
        $(document).ready(function () {
            // Charger les données du profil

            const userProfileUrl = "http://localhost:5000/uploads/utilisateurs/";
              const token = localStorage.getItem("token");

    if (!token) {
      // Aucune connexion
      $("#loginUI").show();
      $("#accountUI").hide();
      return;
    }else{
      
      $("#accountUI").show();
      $("#loginUI").hide();
    }
        $.ajax({
          url: "http://localhost:5000/api/utilisateurs/obtenirMonProfil",
          method: "GET",
          headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
          success: function (user) {
              const profileUrl = userProfileUrl + user?.data.photo;
            console.log(user?.data.photo)
            $(".nom").text(user?.data?.nom);
            $(".email").text(user?.data.email);
            $(".photo").attr("src", profileUrl);
            $("#photo").attr("src", profileUrl);
            $("#pays").text(user?.data.pays || "Non renseigné.");
            $("#dateNaissance").text(user?.data.dateNaissance || "Non renseigné.");
            $("#biographie").text(user?.data.biographie || "Aucune biographie fournie.");
            $("#adresse").text(user?.data.adresse || "Non renseigné.");
            $("#telephone").text(user?.data.telephone || "Non renseignné.");
            $(".role").text(user?.data.role || "Non renseignné.");
            $("#sexe").text(user?.data.sexe || "Non renseignné.");


                 // Affichage conditionnel
      if (user?.data.role === "admin" || user?.data.role === "ambassadeur" || user?.data.role === "etudiant") {
        $("#info-administrative").hide();     // Masquer mot de passe
        $("#info-academique").hide();     // Masquer mot de passe
        $("#saveBtn").hide();         // Masquer bouton "Enregistrer"
      }

      if(user?.data.role ==="proprietaire"){
        $("#accountRedirect").attr("href", "account-dashboard.html");
        $("#accountRedirect").text("Tableau de bord");
        
      }else{
        
        $("#accountRedirect").attr("href", "espace_locataire.html");
        $("#accountRedirect").text("Mon compte");
      }
          },
          error: function () {
              console.log("Erreur lors du chargement du profil !");
            },
        });})
        </script>


<script>
            $(document).ready(function() {
  // Fonction de formatage des dates
  function formaterDate(dateISO) {
    const options = { day: 'numeric', month: 'long', year: 'numeric' };
    return new Date(dateISO).toLocaleDateString('fr-FR', options);
  }

  // Fonction de traduction du statut
  function traduireStatut(statut) {
    const traductions = {
      'en_attente': 'En attente',
      'acceptee': 'Acceptée',
      'refusee': 'Refusée',
      'terminee': 'Terminée',
      'annulee': 'Annulée'
    };
    return traductions[statut] || statut;
  }

  // Fonction de couleur du badge
  function getCouleurStatut(statut) {
    const couleurs = {
      'en_attente': 'warning',
      'acceptee': 'success',
      'refusee': 'danger',
      'terminee': 'primary',
      'annulee': 'secondary'
    };
    return couleurs[statut] || 'dark';
  }

  // Chargement des réservations
  $.ajax({
    url: 'http://localhost:5000/api/locations/mesReservations',
    type: 'GET',
      headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
    success: function(response) {
      const tbody = $('.de-table tbody');
      tbody.empty();

      if (!response.data || response.data.length === 0) {
        tbody.append(`
          <tr>
            <td colspan="7" class="text-center py-4">
              Aucune réservation trouvée
            </td>
          </tr>
        `);
        return;
      }

      response.data.forEach((reservation, index) => {
        const ligne = `
          <tr>
            <td><div class="badge bg-gray-100 text-dark">#${reservation._id.toString().substring(18)}</div></td>
            <td><span class="bold">${reservation.annonce.voiture.marque} ${reservation.annonce.voiture.modele}</span></td>
            <td>${reservation.adresseRetrait}</td>
            <td>${formaterDate(reservation.dateDebut)}</td>
            <td>${formaterDate(reservation.dateFin)}</td>
            <td>${reservation.montantTotal.toFixed(2)}€</td>
            <td>
              <div class="badge rounded-pill bg-${getCouleurStatut(reservation.statut)}">
                ${traduireStatut(reservation.statut)}
              </div>
            </td>
          </tr>
        `;
        tbody.append(ligne);
      });
    },
    error: function(xhr) {
      console.error('Erreur:', xhr.responseJSON);
      $('.de-table tbody').html(`
        <tr>
          <td colspan="7" class="text-center text-danger py-4">
            Erreur lors du chargement des réservations
          </td>
        </tr>
      `);
    }
  });
});
        </script>

</body>

</html>