<!DOCTYPE html>
<html lang="zxx">
  <head>
    <title>Rentaly - Multipurpose Vehicle Car Rental Website Template</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16" />
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta
      content="Rentaly - Multipurpose Vehicle Car Rental Website Template"
      name="description"
    />
    <meta content="" name="keywords" />
    <meta content="" name="author" />
    <!-- CSS Files
    ================================================== -->
    <link
      href="css/bootstrap.min.css"
      rel="stylesheet"
      type="text/css"
      id="bootstrap"
    />
    <link href="css/mdb.min.css" rel="stylesheet" type="text/css" id="mdb" />
    <link href="css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link href="css/coloring.css" rel="stylesheet" type="text/css" />
    <!-- color scheme -->
    <link
      id="colors"
      href="css/colors/scheme-01.css"
      rel="stylesheet"
      type="text/css"
    />
  </head>

  <body>
    <div id="wrapper">
      <!-- page preloader begin -->
      <div id="de-preloader"></div>
      <!-- page preloader close -->

      <!-- header begin -->
      <header class="transparent scroll-light has-topbar">
        <div id="topbar" class="topbar-dark text-light">
          <div class="container">
            <div class="topbar-left xs-hide">
              <div class="topbar-widget">
                <div class="topbar-widget">
                  <a href="#"><i class="fa fa-phone"></i>+208 333 9296</a>
                </div>
                <div class="topbar-widget">
                  <a href="#"
                    ><i class="fa fa-envelope"></i>contact@rentaly.com</a
                  >
                </div>
                <div class="topbar-widget">
                  <a href="#"
                    ><i class="fa fa-clock-o"></i>Mon - Fri 08.00 - 18.00</a
                  >
                </div>
              </div>
            </div>

            <div class="topbar-right">
              <div class="social-icons">
                <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                <a href="#"><i class="fa fa-youtube fa-lg"></i></a>
                <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                <a href="#"><i class="fa fa-instagram fa-lg"></i></a>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="de-flex sm-pt10">
                <div class="de-flex-col">
                  <div class="de-flex-col">
                    <!-- logo begin -->
                    <div id="logo">
                      <a href="index.html">
                        <img
                          class="logo-1"
                          src="images/logo-light.png"
                          alt=""
                        />
                        <img class="logo-2" src="images/logo.png" alt="" />
                      </a>
                    </div>
                    <!-- logo close -->
                  </div>
                </div>
                <div class="de-flex-col header-col-mid">
                  <ul id="mainmenu">
                    <li>
                      <a class="menu-item" href="index.html">Accueil</a>
                    </li>
                    <li>
                      <a class="menu-item" href="cars.html">Voitures</a>
                    </li>
                    <li>
                      <a class="menu-item" href="cars.html">Contact</a>
                    </li>
                  </ul>
                </div>
                <div class="de-flex-col" id="loginButton">
                  <div class="menu_side_area">
                    <a href="login.html" class="btn-main">Se connecter</a>
                    <span id="menu-btn"></span>
                  </div>
                </div>
                <div class="de-flex-col" id="profileButton">
                  <div class="menu_side_area">
                    <div class="de-login-menu">
                      <span id="de-click-menu-profile" class="de-menu-profile">
                        <img
                          src="images/profile/1.jpg"
                          class="img-fluid photo"
                          alt=""
                        />
                      </span>

                      <div id="de-submenu-profile" class="de-submenu">
                        <div class="d-name">
                          <h4 class="nom">Monica Lucas</h4>
                          <span class="text-gray email"
                            >monica@rentaly.com</span
                          >
                        </div>

                        <div class="d-line"></div>

                        <ul class="menu-col">
                          <li>
                            <a href="account-dashboard.html"
                              ><i class="fa fa-home"></i>Tableau de bord</a
                            >
                          </li>
                          <li>
                            <a href="account-profile.html"
                              ><i class="fa fa-user"></i>Mon Profil</a
                            >
                          </li>
                          <li>
                            <a href="account-booking.html"
                              ><i class="fa fa-calendar"></i>Mes Reservations</a
                            >
                          </li>
                          <li>
                            <a href="account-favorite.html"
                              ><i class="fa fa-car"></i>My Favorite Cars</a
                            >
                          </li>
                          <li class="deconnexion">
                            <a href="#"
                              ><i class="fa fa-sign-out"></i>Se deconnecter
                            </a>
                          </li>
                        </ul>
                      </div>
                      <span id="menu-btn"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- header close -->
      <!-- content begin -->
      <div class="no-bottom no-top zebra" id="content">
        <div id="top"></div>

        <!-- section begin -->
        <section id="subheader" class="jarallax text-light">
          <img src="images/background/2.jpg" class="jarallax-img" alt="" />
          <div class="center-y relative text-center">
            <div class="container">
              <div class="row">
                <div class="col-md-12 text-center">
                  <h1>Voitures</h1>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>
        </section>
        <!-- section close -->

        <section id="section-cars">
          <div class="container">
            <div class="row">
              <div class="col-lg-3">
                <div class="item_filter_group">
                  <h4>Nombre de sieges</h4>
                  <div class="de_form">
                    <div class="de_checkbox">
                      <input
                        id="car_seat_1"
                        name="car_seat_1"
                        type="checkbox"
                        value="car_seat_1"
                      />
                      <label for="car_seat_1">2 sieges</label>
                    </div>

                    <div class="de_checkbox">
                      <input
                        id="car_seat_2"
                        name="car_seat_2"
                        type="checkbox"
                        value="car_seat_2"
                      />
                      <label for="car_seat_2">4 sieges</label>
                    </div>

                    <div class="de_checkbox">
                      <input
                        id="car_seat_3"
                        name="car_seat_3"
                        type="checkbox"
                        value="car_seat_3"
                      />
                      <label for="car_seat_3">6 sieges</label>
                    </div>

                    <div class="de_checkbox">
                      <input
                        id="car_seat_4"
                        name="car_seat_4"
                        type="checkbox"
                        value="car_seat_4"
                      />
                      <label for="car_seat_4">6+ sieges</label>
                    </div>
                  </div>
                </div>

                <div class="item_filter_group">
                  <h4>Type de Transmission</h4>
                  <div class="de_form">
                    <div class="de_checkbox">
                      <input
                        id="car_engine_1"
                        name="car_engine_1"
                        type="checkbox"
                        value="car_engine_1"
                      />
                      <label for="car_engine_1">Automatique</label>
                    </div>

                    <div class="de_checkbox">
                      <input
                        id="car_engine_2"
                        name="car_engine_2"
                        type="checkbox"
                        value="car_engine_2"
                      />
                      <label for="car_engine_2">Manuelle</label>
                    </div>
                  </div>
                </div>

                <div class="item_filter_group">
                  <h4>Tarif par jour ($)</h4>
                  <div class="price-input">
                    <div class="field">
                      <span>Min</span>
                      <input type="number" class="input-min" value="0" />
                    </div>
                    <div class="field">
                      <span>Max</span>
                      <input type="number" class="input-max" value="2000" />
                    </div>
                  </div>
                  <div class="slider">
                    <div class="progress"></div>
                  </div>
                  <div class="range-input">
                    <input
                      type="range"
                      class="range-min"
                      min="0"
                      max="2000"
                      value="0"
                      step="1"
                    />
                    <input
                      type="range"
                      class="range-max"
                      min="0"
                      max="2000"
                      value="2000"
                      step="1"
                    />
                  </div>
                </div>
              </div>

              <div class="col-lg-9">
                <div class="row">
                  <div class="col-xl-4 col-lg-6">
                    <div class="de-item mb30">
                      <div class="d-img">
                        <img
                          src="images/cars/jeep-renegade.jpg"
                          class="img-fluid"
                          alt=""
                        />
                      </div>
                      <div class="d-info">
                        <div class="d-text">
                          <h4>Jeep Renegade</h4>
                          <div class="d-item_like">
                            <i class="fa fa-heart"></i><span>25</span>
                          </div>
                          <div class="d-atr-group">
                            <span class="d-atr"
                              ><img
                                src="images/icons/1-green.svg"
                                alt=""
                              />5</span
                            >
                            <span class="d-atr"
                              ><img
                                src="images/icons/2-green.svg"
                                alt=""
                              />2</span
                            >
                            <span class="d-atr"
                              ><img
                                src="images/icons/3-green.svg"
                                alt=""
                              />4</span
                            >
                            <span class="d-atr"
                              ><img
                                src="images/icons/4-green.svg"
                                alt=""
                              />SUV</span
                            >
                          </div>
                          <div class="d-price">
                            A partir de <span>$265</span>
                            <a class="btn-main" href="car-single.html"
                              >Reserver maintenant</a
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-xl-4 col-lg-6">
                    <div class="de-item mb30">
                      <div class="d-img">
                        <img
                          src="images/cars/bmw-m5.jpg"
                          class="img-fluid"
                          alt=""
                        />
                      </div>
                      <div class="d-info">
                        <div class="d-text">
                          <h4>Mini Cooper</h4>
                          <div class="d-item_like">
                            <i class="fa fa-heart"></i><span>79</span>
                          </div>
                          <div class="d-atr-group">
                            <span class="d-atr"
                              ><img
                                src="images/icons/1-green.svg"
                                alt=""
                              />5</span
                            >
                            <span class="d-atr"
                              ><img
                                src="images/icons/2-green.svg"
                                alt=""
                              />2</span
                            >
                            <span class="d-atr"
                              ><img
                                src="images/icons/3-green.svg"
                                alt=""
                              />4</span
                            >
                            <span class="d-atr"
                              ><img
                                src="images/icons/4-green.svg"
                                alt=""
                              />Sedan</span
                            >
                          </div>
                          <div class="d-price">
                            A partir de <span>$244</span>
                            <a class="btn-main" href="car-single.html"
                              >Reserver maintenant</a
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      <!-- content close -->

      <a href="#" id="back-to-top"></a>

      <!-- footer begin -->
      <footer class="text-light">
        <div class="container">
          <div class="row g-custom-x">
            <div class="col-lg-6">
              <div class="widget">
                <h5>A propos de Aridias Cars</h5>
                <p>
                  Ardias Cars est une solution moderne de location de véhicules
                  entre particuliers. Que vous soyez conducteur à la recherche
                  d’un véhicule ou propriétaire souhaitant rentabiliser votre
                  voiture, notre plateforme est faite pour vous.
                </p>
              </div>
            </div>

            <div class="col-lg-3">
              <div class="widget">
                <h5>Contact Info</h5>
                <address class="s1">
                  <span
                    ><i class="id-color fa fa-map-marker fa-lg"></i>08 W 36th
                    St, New York, NY 10001</span
                  >
                  <span
                    ><i class="id-color fa fa-phone fa-lg"></i>+1 333 9296</span
                  >
                  <span
                    ><i class="id-color fa fa-envelope-o fa-lg"></i
                    ><a href="mailto:contact@example.com"
                      >contact@example.com</a
                    ></span
                  >
                  <span
                    ><i class="id-color fa fa-file-pdf-o fa-lg"></i
                    ><a href="#">Download Brochure</a></span
                  >
                </address>
              </div>
            </div>

            <div class="col-lg-3">
              <h5>Quick Links</h5>
              <div class="row">
                <div class="col-lg-6">
                  <div class="widget">
                    <ul>
                      <li><a href="#">About</a></li>
                      <li><a href="#">Blog</a></li>
                      <li><a href="#">Careers</a></li>
                      <li><a href="#">News</a></li>
                      <li><a href="#">Partners</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- footer close -->
    </div>

    <!-- Javascript Files
    ================================================== -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>
    <script>
      // Fonction principale de chargement
      function chargerAnnonces() {
        const filtres = {};

        // --- TARIF MIN / MAX ---
        const prixMin = $(".input-min").val();
        const prixMax = $(".input-max").val();
        if (prixMin) filtres.prixMin = prixMin;
        if (prixMax) filtres.prixMax = prixMax;

        // --- TRANSMISSION ---
        const transmissions = [];
        if ($("#car_engine_1").is(":checked"))
          transmissions.push("automatique");
        if ($("#car_engine_2").is(":checked")) transmissions.push("manuelle");
        if (transmissions.length > 0) filtres.transmission = transmissions;

        // --- NOMBRE DE SIEGES ---
        const sieges = [];
        if ($("#car_seat_1").is(":checked")) sieges.push(2);
        if ($("#car_seat_2").is(":checked")) sieges.push(4);
        if ($("#car_seat_3").is(":checked")) sieges.push(6);
        if ($("#car_seat_4").is(":checked")) sieges.push({ $gt: 6 }); // exemple avancé
        if (sieges.length > 0) filtres.nombreDeSieges = sieges;

        $.ajax({
          url: "http://localhost:5000/api/annonces",
          type: "GET",
          data: filtres,
          success: function (res) {
            const baseUrl = "http://localhost:5000/uploads/voitures/";
            const annonces = res.data;
            console.log(res.data);
            const conteneur = $(".col-lg-9 .row");
            conteneur.empty(); // vide avant remplissage

            if (!annonces || annonces.length === 0) {
              conteneur.append("<p>Aucune annonce trouvée.</p>");
              return;
            }

            annonces.forEach((annonce) => {
              const voitureUrl = baseUrl + annonce.voiture.images[0];
              const voiture = annonce.voiture;
              const html = `
                <div class="col-xl-4 col-lg-6">
                  <div class="de-item mb30">
                    <div class="d-img">
                      <img src="${voitureUrl}" class="img-fluid" alt="">
                    </div>
                    <div class="d-info">
                      <div class="d-text">
                        <h4>${voiture.nom}</h4>
                        <div class="d-item_like">
                          <i class="fa fa-heart"></i><span>0</span>
                        </div>
                        <div class="d-atr-group">
                          <span class="d-atr"><img src="images/icons/1-green.svg" alt="">${
                            voiture.nombreDeSieges
                          }</span>
                          <span class="d-atr"><img src="images/icons/2-green.svg" alt="">${
                            voiture.nombreDePortes
                          }</span>
                          <span class="d-atr"><img src="images/icons/3-green.svg" alt="">${
                            voiture.transmission
                          }</span>
                          <span class="d-atr"><img src="images/icons/4-green.svg" alt="">${
                            voiture.marque
                          }</span>
                        </div>
                        Disponible du ${new Date(
                          annonce.dateDebut
                        ).toLocaleDateString()} au ${new Date(
                annonce.dateFin
              ).toLocaleDateString()}
 
                        <div class="d-price">
                          A partir de <span>$${voiture.tarifParJour}</span>
                          <a class="btn-main" href="car-single.html?id=${
                            annonce._id
                          }">Reserver maintenant</a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              `;
              conteneur.append(html);
            });
          },
          error: function (err) {
            console.error("Erreur :", err);
          },
        });
      }

      // Événement sur tous les filtres
      $("input[type='checkbox'], .input-min, .input-max").on(
        "change",
        chargerAnnonces
      );

      // Chargement initial
      $(document).ready(function () {
        chargerAnnonces();
      });
    </script>

    <script>
      $(document).ready(function () {
        // Charger les données du profil

        const userProfileUrl = "http://localhost:5000/uploads/utilisateurs/";

        if (!localStorage.getItem("token")) {
          $("#loginButton").show();
          $("#profileButton").hide();
        } else {
          $("#loginButton").hide();
          $("#profileButton").show();
        }
        $.ajax({
          url: "http://localhost:5000/api/utilisateurs/obtenirMonProfil",
          method: "GET",
          headers: {
            Authorization: "Bearer " + localStorage.getItem("token"),
          },
          success: function (user) {
            const profileUrl = userProfileUrl + user?.data.photo;
            console.log(user?.data.photo);
            $(".nom").text(user?.data?.nom);
            $(".email").text(user?.data.email);
            $(".photo").attr("src", profileUrl);
            $("#photo").attr("src", profileUrl);

            // Affichage conditionnel
            if (
              user?.data.role === "admin" ||
              user?.data.role === "ambassadeur" ||
              user?.data.role === "etudiant"
            ) {
              $("#info-administrative").hide(); // Masquer mot de passe
              $("#info-academique").hide(); // Masquer mot de passe
              $("#saveBtn").hide(); // Masquer bouton "Enregistrer"
            }
          },
          error: function () {
            console.log("Erreur lors du chargement du profil !");
          },
        });
      });
    </script>

    <script>
      $(".deconnexion").click(function () {
        alert("À bientôt !");
        localStorage.clear();
        window.location.href = "index.html";
      });
    </script>
  </body>
</html>
